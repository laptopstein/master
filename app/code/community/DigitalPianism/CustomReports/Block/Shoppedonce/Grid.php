<?php/** * Class DigitalPianism_CustomReports_Block_Shoppedonce_Grid */class DigitalPianism_CustomReports_Block_Shoppedonce_Grid extends Mage_Adminhtml_Block_Widget_Grid{    /**     *     */    public function __construct()    {        parent::__construct();        $this->setId('shoppedonceReportGrid');        $this->setDefaultSort('created_at');        $this->setDefaultDir('desc');    }    /**     * @return $this     */    protected function _prepareCollection()    {        $collection = Mage::getResourceModel('reports/order_collection')			->addAttributeToSelect('entity_id')			->addAttributeToSelect('customer_email')			->addAttributeToSelect('customer_firstname')			->addAttributeToSelect('customer_lastname')			->addAttributeToSelect('created_at');				$collection->getSelect()->group('customer_email')->having('COUNT(customer_email) = 1');		        $this->setCollection($collection);		        parent::_prepareCollection();        return $this;    }    /**     * @return $this     * @throws Exception     */    protected function _prepareColumns()    {         $this->addColumn('entity_id', array(            'header'    => Mage::helper('reports')->__('Order ID'),			'width'     => '50',            'index'     => 'entity_id'        ));		        $this->addColumn('customer_email', array(            'header'    => Mage::helper('reports')->__('Customer Email'),            'width'     => '300',            'index'     => 'customer_email'        ));        $this->addColumn('customer_firstname', array(            'header'    => Mage::helper('reports')->__('First Name'),            'width'     => '300',            'index'     => 'customer_firstname',        ));        $this->addColumn('customer_lastname', array(            'header'    => Mage::helper('reports')->__('Last Name'),            'width'     => '300',            'index'     => 'customer_lastname',        ));				$this->addColumn('created_at', array(            'header'    =>Mage::helper('reports')->__('Sale Date'),            'align'     =>'right',			'width'     => '150',			'type'      =>'datetime',            'index'     =>'created_at'        ));				$this->addColumn('action',            array(                'header'    =>  Mage::helper('reports')->__('Action'),                'width'     => '100',                'type'      => 'action',                'getter'    => 'getEntityId',                'actions'   => array(                    array(                        'caption'   => Mage::helper('reports')->__('Edit Order'),                        'url'       => array('base'=> 'adminhtml/sales_order/view/'),                        'field'     => 'order_id'                    )                ),                'filter'    => false,                'sortable'  => false,                'index'     => 'stores',                'is_system' => true,        ));        $this->addExportType('*/*/exportShoppedonceCsv', Mage::helper('reports')->__('CSV'));        $this->addExportType('*/*/exportShoppedonceExcel', Mage::helper('reports')->__('Excel'));        return parent::_prepareColumns();    }}